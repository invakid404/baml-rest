syntax = "proto3";

package workerplugin;

option go_package = "github.com/invakid404/baml-rest/workerplugin";

// Request to call a BAML method
message CallRequest {
  string method_name = 1;
  bytes input_json = 2;        // JSON-encoded input struct (includes __baml_options__ if present)
  bool enable_raw_collection = 3;  // When true, capture raw LLM response via OnTick/SSE parsing
}

// Streaming result
message StreamResult {
  enum Kind {
    STREAM = 0;
    FINAL = 1;
    ERROR = 2;
  }
  Kind kind = 1;
  bytes data_json = 2;         // JSON-encoded stream/final data
  string raw = 3;              // Raw LLM response text (populated on FINAL)
  string error = 4;            // Error message (populated on ERROR)
}

// Health check
message Empty {}

message HealthResponse {
  bool healthy = 1;
}

// Worker service
service Worker {
  // Streaming call - returns stream of results
  // Used for both streaming and non-streaming calls
  rpc CallStream(CallRequest) returns (stream StreamResult);

  // Health check
  rpc Health(Empty) returns (HealthResponse);
}
